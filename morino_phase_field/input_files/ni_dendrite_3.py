import numpy as np
import taichi as ti
 

solutes     = ['AL', 'CO']
uini_ave    = np.array([0.163, 0.01])
yini_LIQUID = np.array([[0.1641763746304324, 0.00989896979470943]])
yini_FCC_A1 = np.array([[0.14576407343103367, 0.011480267556554574]])
# solvent  : NI
# solutes  : ['AL', 'CO']
# phases   : ['LIQUID', 'FCC_A1']


@ti.func
def GHSERAL(T):
    return -11278.378+188.684153*T-31.748192*T*ti.log(T)-1.231E+28*(1/T)**(9)

@ti.func
def GHSERCO(T):
    return +310.241+133.36601*T-25.0861*T*ti.log(T)-2.6547387E-3*T**2-1.7348E-07*T**3+72526.9*(1/T)**(1)

@ti.func
def GHSERCR(T):
    return -8856.94+157.48*T-26.908*T*ti.log(T)+0.00189435*T**2-1.47721E-6*T**3+139250*(1/T)**(1)

@ti.func
def GHSERCU(T):
    return -13542.026+183.803828*T-31.38*T*ti.log(T)+3.642E+29*(1/T)**(9)

@ti.func
def GHSERFE(T):
    return +1225.7+124.134*T-23.5143*T*ti.log(T)-0.00439752*T**2-5.89269E-8*T**3+77358.5*(1/T)**(1)

@ti.func
def GHSERMN(T):
    return -28733.41+312.2648*T-48.0*T*ti.log(T)+1.656847E+30*(1/T)**(9)

@ti.func
def GHSERMO(T):
    return -7746.302+131.9197*T-23.56414*T*ti.log(T)-0.003443396*T**2+5.662834E-7*T**3-1.309265E-10*T**4+65812.39*(1/T)**(1)

@ti.func
def GHSERNB(T):
    return -8519.353+142.045475*T-26.4711*T*ti.log(T)+0.203475E-3*T**2-0.35011E-6*T**3+93399*(1/T)**(1)

@ti.func
def GHSERNI(T):
    return -5179.159+117.854*T-22.096*T*ti.log(T)-4.8407E-3*T**2

@ti.func
def GHSERSI(T):
    return -8162.609+137.236859*T-22.8317533*T*ti.log(T)-1.912904E-3*T**2-0.003552E-6*T**3+176667*(1/T)**(1)

@ti.func
def GHSERTI(T):
    return +908.837+66.976538*T-14.9466*T*ti.log(T)-8.1465E-3*T**2+2.02715E-07*T**3-1477660*(1/T)**(1)

@ti.func
def GHSERVV(T):
    return -7967.842+143.291093*T-25.9*T*ti.log(T)+0.0625E-3*T**2-0.68E-6*T**3

@ti.func
def GHSERWW(T):
    return -7646.311+130.4*T-24.1*T*ti.log(T)-1.936E-3*T**2+2.07E-7*T**3-5.33E-11*T**4+44500*(1/T)**(1)

@ti.func
def GHSERZR(T):
    return -7827.595+125.64905*T-24.1618*T*ti.log(T)-4.37791E-3*T**2+34971*(1/T)**(1)

@ti.func
def GCOFCC(T):
    return +427.591-0.61525*T+GHSERCO(T)

@ti.func
def GHFFCC(T):
    return +3012.703+108.544*T-22.7075*T*ti.log(T)-0.004146*T**2-0.000477E-6*T**3-22590*(1/T)**(1)

@ti.func
def GZRFCC(T):
    return +7600-0.9*T+GHSERZR(T)

@ti.func
def GHEXTNB(T):
    return -8519.35+142.048*T-26.4711*T*ti.log(T)+0.203475E-3*T**2-0.350119E-6*T**3+93398.8*(1/T)**(1)

@ti.func
def LF0(T):
    return -20455.7462-11.7930695*T

@ti.func
def LF1(T):
    return +15581.5125-8.49116947*T


@ti.func
def f_LIQUID(T:float,AL1:float,CO1:float) -> float:
    NI1 = (1.0-AL1-CO1)
    return 1/1.0*(+ \
           + 8.3145*T*( +1.0*(+(AL1)*ti.log(AL1) +(CO1)*ti.log(CO1) +(NI1)*ti.log(NI1) ) )+ \
           + AL1                                       *(+10482.382-11.253974*T+1.231E+28*(1/T)**(9)+GHSERAL(T))+ \
           + CO1                                       *(+15085.037-8.931932*T-2.19801E-21*T**(7)+GHSERCO(T))+ \
           + NI1                                       *(+16414.686-9.397*T-3.82318E-21*T**7+GHSERNI(T))+ \
           + AL1*CO1                                   *(-157700+30.4*T)+ \
           + AL1*CO1*(AL1-CO1)                         *(-2600)+ \
           + AL1*CO1*(AL1-CO1)**2                      *(+11600)+ \
           + AL1*CO1*(AL1-CO1)**3                      *(+3250+1.735*T)+ \
           + AL1*NI1                                   *(-207109.28+41.31501*T)+ \
           + AL1*NI1*(AL1-NI1)                         *(-10185.79+5.8714*T)+ \
           + AL1*NI1*(AL1-NI1)**2                      *(+81204.81-31.95713*T)+ \
           + AL1*NI1*(AL1-NI1)**3                      *(+4365.35-2.51632*T)+ \
           + AL1*NI1*(AL1-NI1)**4                      *(-22101.64+13.16341*T)+ \
           + CO1*NI1                                   *(+1331)+ \
           + AL1*CO1*NI1                               *(+30000) )

@ti.func
def fyy_LIQUID_AL1(T:float,AL1:float,CO1:float) -> float:
    fyy_AL1 = 3.0*AL1*CO1*(2*AL1 - 2*CO1)*(1.735*T + 3250) + 23200.0*AL1*CO1 + 24.0*AL1*(4365.35 - 2.51632*T)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - 48.0*AL1*(4365.35 - 2.51632*T)*(AL1 + CO1/2 - 0.5)**2 + 8.0*AL1*(81204.81 - 31.95713*T)*(-AL1 - CO1 + 1.0) - 8.0*AL1*(81204.81 - 31.95713*T)*(2*AL1 + CO1 - 1.0) - 4.0*AL1*(5.8714*T - 10185.79) + 192.0*AL1*(13.16341*T - 22101.64)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - 128.0*AL1*(13.16341*T - 22101.64)*(AL1 + CO1/2 - 0.5)**3 + 6.0*CO1*(AL1 - CO1)**2*(1.735*T + 3250) + 23200.0*CO1*(2*AL1 - 2*CO1) - 65200.0*CO1 + 8.3145*T*(1.0/(-AL1 - CO1 + 1.0) + 1.0/AL1) - 82.63002*T + 24.0*(4365.35 - 2.51632*T)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - 8.0*(4365.35 - 2.51632*T)*(AL1 + CO1/2 - 0.5)**3 + 3*(34922.8 - 20.13056*T)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - (34922.8 - 20.13056*T)*(AL1 + CO1/2 - 0.5)**3 + 4.0*(81204.81 - 31.95713*T)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - 4.0*(81204.81 - 31.95713*T)*(AL1 + CO1/2 - 0.5)**2 + (324819.24 - 127.82852*T)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - (324819.24 - 127.82852*T)*(AL1 + CO1/2 - 0.5)**2 + 4.0*(5.8714*T - 10185.79)*(-AL1 - CO1 + 1.0) - 2.0*(5.8714*T - 10185.79)*(2*AL1 + CO1 - 1.0) + 64.0*(13.16341*T - 22101.64)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**3 - 16.0*(13.16341*T - 22101.64)*(AL1 + CO1/2 - 0.5)**4 + 4*(210.61456*T - 353626.24)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**3 - (210.61456*T - 353626.24)*(AL1 + CO1/2 - 0.5)**4 + 414218.56
    return fyy_AL1
@ti.func
def fyy_LIQUID_CO1(T:float,AL1:float,CO1:float) -> float:
    fyy_CO1 = -3.0*AL1*CO1*(-2*AL1 + 2*CO1)*(1.735*T + 3250) + 23200.0*AL1*CO1 + 12.0*AL1*(4365.35 - 2.51632*T)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5) - 24.0*AL1*(4365.35 - 2.51632*T)*(AL1 + CO1/2 - 0.5)**2 + 2.0*AL1*(81204.81 - 31.95713*T)*(-AL1 - CO1 + 1.0) - 8.0*AL1*(81204.81 - 31.95713*T)*(AL1 + CO1/2 - 0.5) + 23200.0*AL1*(-2*AL1 + 2*CO1) - 6.0*AL1*(AL1 - CO1)**2*(1.735*T + 3250) - 2.0*AL1*(5.8714*T - 10185.79) + 48.0*AL1*(13.16341*T - 22101.64)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - 64.0*AL1*(13.16341*T - 22101.64)*(AL1 + CO1/2 - 0.5)**3 - 54800.0*AL1 + 8.3145*T*(1.0/(-AL1 - CO1 + 1.0) + 1.0/CO1) - 2662.0
    return fyy_CO1

@ti.func
def f_FCC_A1(T:float,AL1:float,CO1:float) -> float:
    NI1 = (1.0-AL1-CO1)
    return 1/1.0*(+ \
           + 8.3145*T*( +1.0*(+(AL1)*ti.log(AL1) +(CO1)*ti.log(CO1) +(NI1)*ti.log(NI1) ) )+ \
           + AL1                                       *(+GHSERAL(T))+ \
           + CO1                                       *(+GCOFCC(T))+ \
           + NI1                                       *(+GHSERNI(T))+ \
           + AL1*CO1                                   *(-105000)+ \
           + AL1*NI1                                   *(-162407.75+16.212965*T)+ \
           + AL1*NI1*(AL1-NI1)                         *(+73417.798-34.914168*T)+ \
           + AL1*NI1*(AL1-NI1)**2                      *(+33471.014-9.8373558*T)+ \
           + AL1*NI1*(AL1-NI1)**3                      *(-30758.01+10.25267*T)+ \
           + CO1*NI1                                   *(-800+1.2629*T)+ \
           + AL1*CO1*NI1                               *(-7500+5*T) )

@ti.func
def fyy_FCC_A1_AL1(T:float,AL1:float,CO1:float) -> float:
    fyy_AL1 = 8.0*AL1*(33471.014 - 9.8373558*T)*(-AL1 - CO1 + 1.0) - 8.0*AL1*(33471.014 - 9.8373558*T)*(2*AL1 + CO1 - 1.0) - 4.0*AL1*(73417.798 - 34.914168*T) + 24.0*AL1*(10.25267*T - 30758.01)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - 48.0*AL1*(10.25267*T - 30758.01)*(AL1 + CO1/2 - 0.5)**2 - 2.0*CO1*(5*T - 7500) + 8.3145*T*(1.0/(-AL1 - CO1 + 1.0) + 1.0/AL1) - 32.42593*T + 4.0*(33471.014 - 9.8373558*T)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - 4.0*(33471.014 - 9.8373558*T)*(AL1 + CO1/2 - 0.5)**2 + 4.0*(73417.798 - 34.914168*T)*(-AL1 - CO1 + 1.0) - 2.0*(73417.798 - 34.914168*T)*(2*AL1 + CO1 - 1.0) + (133884.056 - 39.3494232*T)*(-AL1 - CO1 + 1.0)*(2*AL1 + CO1 - 1.0) - (133884.056 - 39.3494232*T)*(AL1 + CO1/2 - 0.5)**2 + 24.0*(10.25267*T - 30758.01)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - 8.0*(10.25267*T - 30758.01)*(AL1 + CO1/2 - 0.5)**3 + 3*(82.02136*T - 246064.08)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5)**2 - (82.02136*T - 246064.08)*(AL1 + CO1/2 - 0.5)**3 + 324815.5
    return fyy_AL1
@ti.func
def fyy_FCC_A1_CO1(T:float,AL1:float,CO1:float) -> float:
    fyy_CO1 = 2.0*AL1*(33471.014 - 9.8373558*T)*(-AL1 - CO1 + 1.0) - 8.0*AL1*(33471.014 - 9.8373558*T)*(AL1 + CO1/2 - 0.5) - 2.0*AL1*(73417.798 - 34.914168*T) - 2.0*AL1*(5*T - 7500) + 12.0*AL1*(10.25267*T - 30758.01)*(-AL1 - CO1 + 1.0)*(AL1 + CO1/2 - 0.5) - 24.0*AL1*(10.25267*T - 30758.01)*(AL1 + CO1/2 - 0.5)**2 + 8.3145*T*(1.0/(-AL1 - CO1 + 1.0) + 1.0/CO1) - 2.5258*T + 1600.0
    return fyy_CO1

@ti.func
def cal_f(i:int,T:float,y:float) -> float:
    f = 0.0
    if   i == 0: f = f_LIQUID(T,y[0,0],y[0,1])
    elif i == 1: f = f_FCC_A1(T,y[1,0],y[1,1])
    return f

@ti.func
def cal_fyy(a:int,j:int,T:float,y:float) -> float:
    fyy = 0.0
    if   a == 0: # if sublattice 1 in LIQUID
        if   j == 0: fyy = fyy_LIQUID_AL1(T,y[0,0],y[0,1])
        elif j == 1: fyy = fyy_LIQUID_CO1(T,y[0,0],y[0,1])
    elif a == 1: # if sublattice 1 in FCC_A1
        if   j == 0: fyy = fyy_FCC_A1_AL1(T,y[1,0],y[1,1])
        elif j == 1: fyy = fyy_FCC_A1_CO1(T,y[1,0],y[1,1])
    return fyy

